
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Evaluate and track LLM applications. Explain Deep Neural Nets.">
      
      
      
      
        <link rel="prev" href="../trullama/">
      
      
        <link rel="next" href="../../use_cases_any/">
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.4">
    
    
      
        <title>TruCustom - TruLens</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.240905d7.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../stylesheets/cover.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="trulens" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tru-custom-app" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="TruLens" class="md-header__button md-logo" aria-label="TruLens" data-md-component="logo">
      
  <img src="../../../img/squid.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TruLens
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TruCustom
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/truera/trulens" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    truera/trulens
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../welcome/" class="md-tabs__link">
      Welcome to TruLens!
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../install/" class="md-tabs__link md-tabs__link--active">
        Eval
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../trulens_explain/install/" class="md-tabs__link">
        Explain
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="TruLens" class="md-nav__button md-logo" aria-label="TruLens" data-md-component="logo">
      
  <img src="../../../img/squid.png" alt="logo">

    </a>
    TruLens
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/truera/trulens" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    truera/trulens
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../welcome/" class="md-nav__link">
        Welcome to TruLens!
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Eval
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Eval
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        üöÄ Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_1_2" id="__nav_3_1_2_label" tabindex="0">
          ‚ö° Quickstarts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          ‚ö° Quickstarts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../langchain_quickstart/" class="md-nav__link">
        Langchain Quickstart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../llama_index_quickstart/" class="md-nav__link">
        Llama-Index Quickstart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../text2text_quickstart/" class="md-nav__link">
        Text to Text Quickstart
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          Evaluation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Evaluation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2_1" id="__nav_3_2_1_label" tabindex="0">
          üéØ Feedback Functions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2_1">
          <span class="md-nav__icon md-icon"></span>
          üéØ Feedback Functions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../function_definitions/" class="md-nav__link">
        Feedback Function Definitions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../feedback_function_guide/" class="md-nav__link">
        Feedback Function Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../custom_feedback_functions/" class="md-nav__link">
        Custom Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1_4" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2_1_4" id="__nav_3_2_1_4_label" tabindex="0">
          Smoke Tests
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_1_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2_1_4">
          <span class="md-nav__icon md-icon"></span>
          Smoke Tests
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../answer_relevance_smoke_tests/" class="md-nav__link">
        Answer Relevance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../context_relevance_smoke_tests/" class="md-nav__link">
        Context Relevance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
          üìö API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2_2">
          <span class="md-nav__icon md-icon"></span>
          üìö API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feedback/" class="md-nav__link">
        Feedback Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2_2_2" id="__nav_3_2_2_2_label" tabindex="0">
          Providers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2_2_2">
          <span class="md-nav__icon md-icon"></span>
          Providers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openai_provider/" class="md-nav__link">
        OpenAI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bedrock_provider/" class="md-nav__link">
        AWS Bedrock
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../huggingface_provider/" class="md-nav__link">
        HuggingFace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../litellm_provider/" class="md-nav__link">
        LiteLLM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Tracking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Tracking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3_1" id="__nav_3_3_1_label" tabindex="0">
          üé∫ Instrumentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3_1">
          <span class="md-nav__icon md-icon"></span>
          üé∫ Instrumentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basic_instrumentation/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../langchain_instrumentation/" class="md-nav__link">
        LangChain Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../llama_index_instrumentation/" class="md-nav__link">
        Llama-Index Integration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3_2" id="__nav_3_3_2_label" tabindex="0">
          üöö Logging
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3_2">
          <span class="md-nav__icon md-icon"></span>
          üöö Logging
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../where_to_log/" class="md-nav__link">
        Where to Log
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/" class="md-nav__link">
        Logging Methods
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3_3" id="__nav_3_3_3_label" tabindex="0">
          üìö API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_3_3">
          <span class="md-nav__icon md-icon"></span>
          üìö API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tru/" class="md-nav__link">
        Tru
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trubasicapp/" class="md-nav__link">
        TruBasicApp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../truchain/" class="md-nav__link">
        TruChain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trullama/" class="md-nav__link">
        TruLlama
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          TruCustom
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        TruCustom
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app" class="md-nav__link">
    trulens_eval.trulens_eval.tru_custom_app
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--custom-class-apps" class="md-nav__link">
    Custom class Apps
  </a>
  
    <nav class="md-nav" aria-label="Custom class Apps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--example-usage" class="md-nav__link">
    Example Usage
  </a>
  
    <nav class="md-nav" aria-label="Example Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--custom_apppy" class="md-nav__link">
    wzxhzdk:8
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--custom_retrieverpy" class="md-nav__link">
    wzxhzdk:9
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--examplepy" class="md-nav__link">
    wzxhzdk:14
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--instrumenting-3rd-party-classes" class="md-nav__link">
    Instrumenting wzxhzdk:33 party classes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--api-usage-tracking" class="md-nav__link">
    API Usage Tracking
  </a>
  
    <nav class="md-nav" aria-label="API Usage Tracking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--covered-llm-libraries" class="md-nav__link">
    Covered LLM Libraries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--huggingface" class="md-nav__link">
    Huggingface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--what-can-go-wrong" class="md-nav__link">
    What can go wrong
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app.TruCustomApp" class="md-nav__link">
    TruCustomApp
  </a>
  
    <nav class="md-nav" aria-label="TruCustomApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app.TruCustomApp.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app.instrument" class="md-nav__link">
    instrument
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_4_1" id="__nav_3_4_1_label" tabindex="0">
          üîç Use Cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4_1">
          <span class="md-nav__icon md-icon"></span>
          üîç Use Cases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases_any/" class="md-nav__link">
        Any LLM App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases_rag/" class="md-nav__link">
        RAGs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases_agent/" class="md-nav__link">
        LLM Agents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases_production/" class="md-nav__link">
        Dev to Prod
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Contributing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        ü§ù Contrbution Guidelines
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Explain
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Explain
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../trulens_explain/install/" class="md-nav__link">
        üöÄ Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../trulens_explain/quickstart/" class="md-nav__link">
        ‚ö° Quickstart
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../trulens_explain/attribution_parameterization/" class="md-nav__link">
        Attributions
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../trulens_explain/api/attribution/" class="md-nav__link">
        Attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../trulens_explain/api/model_wrappers/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../trulens_explain/api/slices/" class="md-nav__link">
        Slices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../trulens_explain/api/quantities/" class="md-nav__link">
        Quantities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../trulens_explain/api/distributions/" class="md-nav__link">
        Distributions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../trulens_explain/api/visualizations/" class="md-nav__link">
        Visualizations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app" class="md-nav__link">
    trulens_eval.trulens_eval.tru_custom_app
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--custom-class-apps" class="md-nav__link">
    Custom class Apps
  </a>
  
    <nav class="md-nav" aria-label="Custom class Apps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--example-usage" class="md-nav__link">
    Example Usage
  </a>
  
    <nav class="md-nav" aria-label="Example Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--custom_apppy" class="md-nav__link">
    wzxhzdk:8
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--custom_retrieverpy" class="md-nav__link">
    wzxhzdk:9
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--examplepy" class="md-nav__link">
    wzxhzdk:14
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--instrumenting-3rd-party-classes" class="md-nav__link">
    Instrumenting wzxhzdk:33 party classes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--api-usage-tracking" class="md-nav__link">
    API Usage Tracking
  </a>
  
    <nav class="md-nav" aria-label="API Usage Tracking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--covered-llm-libraries" class="md-nav__link">
    Covered LLM Libraries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--huggingface" class="md-nav__link">
    Huggingface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app--what-can-go-wrong" class="md-nav__link">
    What can go wrong
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app.TruCustomApp" class="md-nav__link">
    TruCustomApp
  </a>
  
    <nav class="md-nav" aria-label="TruCustomApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app.TruCustomApp.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trulens_eval.trulens_eval.tru_custom_app.instrument" class="md-nav__link">
    instrument
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="tru-custom-app">Tru Custom App<a class="headerlink" href="#tru-custom-app" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">


<a id="trulens_eval.trulens_eval.tru_custom_app"></a>
  <div class="doc doc-contents first">
  
      <h2 id="trulens_eval.trulens_eval.tru_custom_app--custom-class-apps">Custom class Apps<a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--custom-class-apps" title="Permanent link">&para;</a></h2>
<p>This wrapper covers apps that are not based on one of the high-level frameworks
such as langchain or llama-index. We instead assume that some python class or
classes implements an app which has similar functionality to LLM apps coded in
the high-level frameworks in that it generally processes text queries to produce
text outputs while making intermediate queries to things like LLMs, vector DBs,
and similar.</p>
<h3 id="trulens_eval.trulens_eval.tru_custom_app--example-usage">Example Usage<a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--example-usage" title="Permanent link">&para;</a></h3>
<p>Consider a mock question-answering app with a context retriever component coded
up as two classes in two python, <code>CustomApp</code> and <code>CustomRetriever</code>:</p>
<h4 id="trulens_eval.trulens_eval.tru_custom_app--custom_apppy"><code>custom_app.py</code><a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--custom_apppy" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">trulens_eval.tru_custom_app</span> <span class="kn">import</span> <span class="n">instrument</span>
<span class="kn">from</span> <span class="nn">custom_retriever</span> <span class="kn">import</span> <span class="n">CustomRetriever</span> 


<span class="k">class</span> <span class="nc">CustomApp</span><span class="p">:</span>
    <span class="c1"># NOTE: No restriction on this class.</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span> <span class="o">=</span> <span class="n">CustomRetriever</span><span class="p">()</span>

    <span class="nd">@instrument</span>
    <span class="k">def</span> <span class="nf">retrieve_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">retriever</span><span class="o">.</span><span class="n">retrieve_chunks</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@instrument</span>
    <span class="k">def</span> <span class="nf">respond_to_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_chunks</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The answer to </span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s2"> is</span>
        <span class="n">probably</span> <span class="p">{</span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span> <span class="ow">or</span> <span class="n">something</span> <span class="o">...</span><span class="s2">&quot; return output</span>
</code></pre></div>
<h4 id="trulens_eval.trulens_eval.tru_custom_app--custom_retrieverpy"><code>custom_retriever.py</code><a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--custom_retrieverpy" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">trulens_eval.tru_custom_app</span> <span class="kn">import</span> <span class="n">instrument</span>

<span class="k">class</span> <span class="nc">CustomRetriever</span><span class="p">:</span>
    <span class="c1"># NOTE: No restriction on this class either.</span>

    <span class="nd">@instrument</span>
    <span class="k">def</span> <span class="nf">retrieve_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;Relevant chunk: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Relevant chunk: </span><span class="si">{</span><span class="n">data</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span>
</code></pre></div>
<p>The core tool for instrumenting these classes is the <code>instrument</code> method
(actually class, but details are not important here). trulens needs to be aware
of two high-level concepts to usefully monitor the app: components and methods
used by components. The <code>instrument</code> must decorate each method that the user
wishes to watch (for it to show up on the dashboard). In the example, all of the
functionalities are decorated. Additionally, the owner classes of any decorated
method is viewed as an app component. In this case <code>CustomApp</code> and
<code>CustomRetriever</code> are components. </p>
<p>Following the instrumentation, the app can be used with or without tracking:</p>
<h4 id="trulens_eval.trulens_eval.tru_custom_app--examplepy"><code>example.py</code><a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--examplepy" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">custom_app</span> <span class="kn">import</span> <span class="n">CustomApp</span> <span class="kn">from</span> <span class="nn">trulens_eval.tru_custom_app</span>
<span class="kn">import</span> <span class="n">TruCustomApp</span>

<span class="n">ca</span> <span class="o">=</span> <span class="n">CustomApp</span><span class="p">()</span>

<span class="c1"># Normal app Usage:</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">respond_to_query</span><span class="p">(</span><span class="s2">&quot;What is the capital of Indonesia?&quot;</span><span class="p">)</span>

<span class="c1"># Wrapping app with `TruCustomApp`: </span>
<span class="n">ta</span> <span class="o">=</span> <span class="n">TruCustomApp</span><span class="p">(</span><span class="n">ca</span><span class="p">)</span>

<span class="c1"># Wrapped Usage: must use the general `with_record` (or `awith_record`) method:</span>
<span class="n">response</span><span class="p">,</span> <span class="n">record</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">with_record</span><span class="p">(</span>
    <span class="n">ca</span><span class="o">.</span><span class="n">respond_to_query</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;What is the capital of Indonesia?&quot;</span>
<span class="p">)</span>
</code></pre></div>
<p>The <code>with_record</code> use above returns both the response of the app normally
produces as well as the record of the app as is the case with the higher-level
wrappers. <code>TruCustomApp</code> constructor arguments are like in those higher-level
apps as well including the feedback functions, metadata, etc.</p>
<h4 id="trulens_eval.trulens_eval.tru_custom_app--instrumenting-3rd-party-classes">Instrumenting 3<sup>rd</sup> party classes<a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--instrumenting-3rd-party-classes" title="Permanent link">&para;</a></h4>
<p>In cases you do not have access to a class to make the necessary decorations for
tracking, you can instead use one of the static methods of <code>instrument</code>, for
example, the alterative for making sure the custom retriever gets instrumented
is via:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># custom_app.py`:</span>

<span class="kn">from</span> <span class="nn">trulens_eval.tru_custom_app</span> <span class="kn">import</span> <span class="n">instrument</span>
<span class="kn">from</span> <span class="nn">somepackage.from</span> <span class="n">custom_retriever</span> <span class="kn">import</span> <span class="nn">CustomRetriever</span>

<span class="n">instrument</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">CustomRetriever</span><span class="p">,</span> <span class="s2">&quot;retrieve_chunks&quot;</span><span class="p">)</span>

<span class="c1"># ... rest of the custom class follows ...</span>
</code></pre></div>
<h3 id="trulens_eval.trulens_eval.tru_custom_app--api-usage-tracking">API Usage Tracking<a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--api-usage-tracking" title="Permanent link">&para;</a></h3>
<p>Uses of python libraries for common LLMs like OpenAI are tracked in custom class
apps.</p>
<h4 id="trulens_eval.trulens_eval.tru_custom_app--covered-llm-libraries">Covered LLM Libraries<a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--covered-llm-libraries" title="Permanent link">&para;</a></h4>
<ul>
<li>Official OpenAI python package (<a href="https://github.com/openai/openai-python">https://github.com/openai/openai-python</a>).</li>
</ul>
<h4 id="trulens_eval.trulens_eval.tru_custom_app--huggingface">Huggingface<a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--huggingface" title="Permanent link">&para;</a></h4>
<p>Uses of huggingface inference APIs are tracked as long as requests are made
through the <code>requests</code> class's <code>post</code> method to the URL
<a href="https://api-inference.huggingface.co">https://api-inference.huggingface.co</a> .</p>
<h3 id="trulens_eval.trulens_eval.tru_custom_app--limitations">Limitations<a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--limitations" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Tracked (instrumented) components must be accessible through other tracked
  components. Specifically, an app cannot have a custom class that is not
  instrumented but that contains an instrumented class. The inner instrumented
  class will not be found by trulens.</p>
</li>
<li>
<p>All tracked components are categorized as "Custom" (as opposed to Template,
  LLM, etc.). That is, there is no categorization available for custom
  components. They will all show up as "uncategorized" in the dashboard.</p>
</li>
<li>
<p>Non json-like contents of components (that themselves are not components) are
  not recorded or available in dashboard. This can be alleviated to some extent
  with the <code>app_extra_json</code> argument to <code>TruCustomClass</code> as it allows one to
  specify in the form of json additional information to store alongside the
  component hierarchy. Json-like (json bases like string, int, and containers
  like sequences and dicts are included).</p>
</li>
</ul>
<h3 id="trulens_eval.trulens_eval.tru_custom_app--what-can-go-wrong">What can go wrong<a class="headerlink" href="#trulens_eval.trulens_eval.tru_custom_app--what-can-go-wrong" title="Permanent link">&para;</a></h3>
<ul>
<li>If a <code>with_record</code> or <code>awith_record</code> call does not encounter any instrumented
  method, it will raise an error. You can check which methods are instrumented
  using <code>App.print_instrumented</code>. You may have forgotten to decorate relevant
  methods with <code>@instrument</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">app</span><span class="o">.</span><span class="n">print_instrumented</span><span class="p">()</span>

<span class="c1">### output example:</span>
<span class="n">Components</span><span class="p">:</span>
        <span class="n">TruCustomApp</span> <span class="p">(</span><span class="n">Other</span><span class="p">)</span> <span class="n">at</span> <span class="mh">0x171bd3380</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span>
        <span class="n">CustomApp</span> <span class="p">(</span><span class="n">Custom</span><span class="p">)</span> <span class="n">at</span> <span class="mh">0x12114b820</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span>
        <span class="n">CustomLLM</span> <span class="p">(</span><span class="n">Custom</span><span class="p">)</span> <span class="n">at</span> <span class="mh">0x12114be50</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">llm</span>
        <span class="n">CustomMemory</span> <span class="p">(</span><span class="n">Custom</span><span class="p">)</span> <span class="n">at</span> <span class="mh">0x12114bf40</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">memory</span>
        <span class="n">CustomRetriever</span> <span class="p">(</span><span class="n">Custom</span><span class="p">)</span> <span class="n">at</span> <span class="mh">0x12114bd60</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">retriever</span>
        <span class="n">CustomTemplate</span> <span class="p">(</span><span class="n">Custom</span><span class="p">)</span> <span class="n">at</span> <span class="mh">0x12114bf10</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">template</span>

<span class="n">Methods</span><span class="p">:</span>
<span class="n">Object</span> <span class="n">at</span> <span class="mh">0x12114b820</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomApp</span><span class="o">.</span><span class="n">retrieve_chunks</span> <span class="n">at</span> <span class="mh">0x299132ca0</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span>
        <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomApp</span><span class="o">.</span><span class="n">respond_to_query</span> <span class="n">at</span> <span class="mh">0x299132d30</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span>
        <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomApp</span><span class="o">.</span><span class="n">arespond_to_query</span> <span class="n">at</span> <span class="mh">0x299132dc0</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span>
<span class="n">Object</span> <span class="n">at</span> <span class="mh">0x12114be50</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomLLM</span><span class="o">.</span><span class="n">generate</span> <span class="n">at</span> <span class="mh">0x299106b80</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">llm</span>
<span class="n">Object</span> <span class="n">at</span> <span class="mh">0x12114bf40</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomMemory</span><span class="o">.</span><span class="n">remember</span> <span class="n">at</span> <span class="mh">0x299132670</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">memory</span>
<span class="n">Object</span> <span class="n">at</span> <span class="mh">0x12114bd60</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomRetriever</span><span class="o">.</span><span class="n">retrieve_chunks</span> <span class="n">at</span> <span class="mh">0x299132790</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">retriever</span>
<span class="n">Object</span> <span class="n">at</span> <span class="mh">0x12114bf10</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomTemplate</span><span class="o">.</span><span class="n">fill</span> <span class="n">at</span> <span class="mh">0x299132a60</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">path</span> <span class="o">*.</span><span class="n">__app__</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">template</span>
</code></pre></div>
<ul>
<li>If an instrumented / decorated method's owner object cannot be found when
  traversing your custom class, you will get a warning. This may be ok in the
  end but may be indicative of a problem. Specifically, note the "Tracked"
  limitation above. You can also use the <code>app_extra_json</code> argument to <code>App</code> /
  <code>TruCustomApp</code> to provide a structure to stand in place for (or augment) the
  data produced by walking over instrumented components to make sure this
  hierarchy contains the owner of each instrumented method.</li>
</ul>
<p>The owner-not-found error looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">Function</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomRetriever</span><span class="o">.</span><span class="n">retrieve_chunks</span> <span class="n">at</span> <span class="mh">0x177935d30</span><span class="o">&gt;</span> <span class="n">was</span> <span class="ow">not</span> <span class="n">found</span> <span class="n">during</span> <span class="n">instrumentation</span> <span class="n">walk</span><span class="o">.</span> <span class="n">Make</span> <span class="n">sure</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">accessible</span> <span class="n">by</span> <span class="n">traversing</span> <span class="n">app</span> <span class="o">&lt;</span><span class="n">custom_app</span><span class="o">.</span><span class="n">CustomApp</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x112a005b0</span><span class="o">&gt;</span> <span class="ow">or</span> <span class="n">provide</span> <span class="n">a</span> <span class="n">bound</span> <span class="n">method</span> <span class="k">for</span> <span class="n">it</span> <span class="k">as</span> <span class="n">TruCustomApp</span> <span class="n">constructor</span> <span class="n">argument</span> <span class="err">`</span><span class="n">methods_to_instrument</span><span class="err">`</span><span class="o">.</span>
<span class="n">Function</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomTemplate</span><span class="o">.</span><span class="n">fill</span> <span class="n">at</span> <span class="mh">0x1779474c0</span><span class="o">&gt;</span> <span class="n">was</span> <span class="ow">not</span> <span class="n">found</span> <span class="n">during</span> <span class="n">instrumentation</span> <span class="n">walk</span><span class="o">.</span> <span class="n">Make</span> <span class="n">sure</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">accessible</span> <span class="n">by</span> <span class="n">traversing</span> <span class="n">app</span> <span class="o">&lt;</span><span class="n">custom_app</span><span class="o">.</span><span class="n">CustomApp</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x112a005b0</span><span class="o">&gt;</span> <span class="ow">or</span> <span class="n">provide</span> <span class="n">a</span> <span class="n">bound</span> <span class="n">method</span> <span class="k">for</span> <span class="n">it</span> <span class="k">as</span> <span class="n">TruCustomApp</span> <span class="n">constructor</span> <span class="n">argument</span> <span class="err">`</span><span class="n">methods_to_instrument</span><span class="err">`</span><span class="o">.</span>
<span class="n">Function</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">CustomLLM</span><span class="o">.</span><span class="n">generate</span> <span class="n">at</span> <span class="mh">0x1779471f0</span><span class="o">&gt;</span> <span class="n">was</span> <span class="ow">not</span> <span class="n">found</span> <span class="n">during</span> <span class="n">instrumentation</span> <span class="n">walk</span><span class="o">.</span> <span class="n">Make</span> <span class="n">sure</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">accessible</span> <span class="n">by</span> <span class="n">traversing</span> <span class="n">app</span> <span class="o">&lt;</span><span class="n">custom_app</span><span class="o">.</span><span class="n">CustomApp</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x112a005b0</span><span class="o">&gt;</span> <span class="ow">or</span> <span class="n">provide</span> <span class="n">a</span> <span class="n">bound</span> <span class="n">method</span> <span class="k">for</span> <span class="n">it</span> <span class="k">as</span> <span class="n">TruCustomApp</span> <span class="n">constructor</span> <span class="n">argument</span> <span class="err">`</span><span class="n">methods_to_instrument</span><span class="err">`</span><span class="o">.</span>
</code></pre></div>
<p>Subsequent attempts at <code>with_record</code>/<code>awith_record</code> may result in the "Empty
  record" exception.</p>
<ul>
<li>Usage tracking not tracking. We presently have limited coverage over which
  APIs we track and make some assumptions with regards to accessible APIs
  through lower-level interfaces. Specifically, we only instrument the
  <code>requests</code> module's <code>post</code> method for the lower level tracking. Please file an
  issue on github with your use cases so we can work out a more complete
  solution as needed.</li>
</ul>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="trulens_eval.trulens_eval.tru_custom_app.TruCustomApp" class="doc doc-heading">
          <code>TruCustomApp</code>


<a href="#trulens_eval.trulens_eval.tru_custom_app.TruCustomApp" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="trulens_eval.app.App">App</span></code></p>

  
      <p>Instantiates a Custom App that can be tracked as long as methods are decorated with @instrument.</p>
<p><strong>Usage:</strong></p>
<p><div class="highlight"><pre><span></span><code>from trulens_eval import instrument

class CustomApp:

    def __init__(self):
        self.retriever = CustomRetriever()
        self.llm = CustomLLM()
        self.template = CustomTemplate(
            &quot;The answer to {question} is probably {answer} or something ...&quot;
        )

    @instrument
    def retrieve_chunks(self, data):
        return self.retriever.retrieve_chunks(data)

    @instrument
    def respond_to_query(self, input):
        chunks = self.retrieve_chunks(input)
        answer = self.llm.generate(&quot;,&quot;.join(chunks))
        output = self.template.fill(question=input, answer=answer)

        return output

ca = CustomApp()
from trulens_eval import TruCustomApp
# f_lang_match, f_qa_relevance, f_qs_relevance are feedback functions
tru_recorder = TruCustomApp(ca, 
    app_id=&quot;Custom Application v1&quot;,
    feedbacks=[f_lang_match, f_qa_relevance, f_qs_relevance])

question = &quot;What is the capital of Indonesia?&quot;

# Normal Usage:
response_normal = ca.respond_to_query(question)

# Instrumented Usage:
with tru_recorder as recording:
    ca.respond_to_query(question)

tru_record = recording.records[0]

# To add record metadata 
with tru_recorder as recording:
    recording.record_metadata=&quot;this is metadata for all records in this context that follow this line&quot;
    ca.respond_to_query(&quot;What is llama 2?&quot;)
    recording.record_metadata=&quot;this is different metadata for all records in this context that follow this line&quot;
    ca.respond_to_query(&quot;Where do I download llama 2?&quot;)
</code></pre></div>
See <a href="https://www.trulens.org/trulens_eval/api/feedback/">Feedback Functions</a> for instantiating feedback functions.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>app</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Any class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>trulens_eval/trulens_eval/tru_custom_app.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TruCustomApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instantiates a Custom App that can be tracked as long as methods are decorated with @instrument.</span>

<span class="sd">        **Usage:**</span>

<span class="sd">        ```</span>
<span class="sd">        from trulens_eval import instrument</span>

<span class="sd">        class CustomApp:</span>

<span class="sd">            def __init__(self):</span>
<span class="sd">                self.retriever = CustomRetriever()</span>
<span class="sd">                self.llm = CustomLLM()</span>
<span class="sd">                self.template = CustomTemplate(</span>
<span class="sd">                    &quot;The answer to {question} is probably {answer} or something ...&quot;</span>
<span class="sd">                )</span>

<span class="sd">            @instrument</span>
<span class="sd">            def retrieve_chunks(self, data):</span>
<span class="sd">                return self.retriever.retrieve_chunks(data)</span>

<span class="sd">            @instrument</span>
<span class="sd">            def respond_to_query(self, input):</span>
<span class="sd">                chunks = self.retrieve_chunks(input)</span>
<span class="sd">                answer = self.llm.generate(&quot;,&quot;.join(chunks))</span>
<span class="sd">                output = self.template.fill(question=input, answer=answer)</span>

<span class="sd">                return output</span>

<span class="sd">        ca = CustomApp()</span>
<span class="sd">        from trulens_eval import TruCustomApp</span>
<span class="sd">        # f_lang_match, f_qa_relevance, f_qs_relevance are feedback functions</span>
<span class="sd">        tru_recorder = TruCustomApp(ca, </span>
<span class="sd">            app_id=&quot;Custom Application v1&quot;,</span>
<span class="sd">            feedbacks=[f_lang_match, f_qa_relevance, f_qs_relevance])</span>

<span class="sd">        question = &quot;What is the capital of Indonesia?&quot;</span>

<span class="sd">        # Normal Usage:</span>
<span class="sd">        response_normal = ca.respond_to_query(question)</span>

<span class="sd">        # Instrumented Usage:</span>
<span class="sd">        with tru_recorder as recording:</span>
<span class="sd">            ca.respond_to_query(question)</span>

<span class="sd">        tru_record = recording.records[0]</span>

<span class="sd">        # To add record metadata </span>
<span class="sd">        with tru_recorder as recording:</span>
<span class="sd">            recording.record_metadata=&quot;this is metadata for all records in this context that follow this line&quot;</span>
<span class="sd">            ca.respond_to_query(&quot;What is llama 2?&quot;)</span>
<span class="sd">            recording.record_metadata=&quot;this is different metadata for all records in this context that follow this line&quot;</span>
<span class="sd">            ca.respond_to_query(&quot;Where do I download llama 2?&quot;)</span>

<span class="sd">        ```</span>
<span class="sd">        See [Feedback Functions](https://www.trulens.org/trulens_eval/api/feedback/) for instantiating feedback functions.</span>

<span class="sd">        Args:</span>
<span class="sd">            app (Any): Any class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">Any</span>

    <span class="n">root_callable</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">FunctionOrMethod</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Methods marked as needing instrumentation. These are checked to make sure</span>
    <span class="c1"># the object walk finds them. If not, a message is shown to let user know</span>
    <span class="c1"># how to let the TruCustomApp constructor know where these methods are.</span>
    <span class="n">functions_to_instrument</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="n">main_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Function</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># serialized version of the below</span>
    <span class="n">main_method_loaded</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># main_async_method: Optional[Union[Callable, Method]] = None # = Field(exclude=True)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">methods_to_instrument</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrap a custom class for recording.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        - app: Any -- the custom app object being wrapped.</span>
<span class="sd">        - More args in App</span>
<span class="sd">        - More args in AppDefinition</span>
<span class="sd">        - More args in WithClassInfo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;app&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;root_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="n">of_object</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

        <span class="n">instrument</span> <span class="o">=</span> <span class="n">Instrument</span><span class="p">(</span>
            <span class="n">app</span><span class="o">=</span><span class="bp">self</span>  <span class="c1"># App mixes in WithInstrumentCallbacks</span>
        <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;instrument&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instrument</span>

        <span class="k">if</span> <span class="s1">&#39;main_method&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">main_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;main_method&#39;</span><span class="p">]</span>

            <span class="c1"># TODO: ARGPARSE</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">main_method</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">main_method</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="o">**</span><span class="n">main_method</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">main_method</span><span class="p">,</span> <span class="n">Function</span><span class="p">):</span>
                <span class="n">main_method_loaded</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
                <span class="n">main_name</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="n">name</span>

                <span class="bp">cls</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">main_name</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="n">main_method_loaded</span> <span class="o">=</span> <span class="n">main_method</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">main_method_loaded</span><span class="p">,</span> <span class="s2">&quot;__self__&quot;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Please specify `main_method` as a bound method (like `someapp.somemethod` instead of `Someclass.somemethod`).&quot;</span>
                    <span class="p">)</span>

                <span class="n">app_self</span> <span class="o">=</span> <span class="n">main_method_loaded</span><span class="o">.</span><span class="vm">__self__</span>

                <span class="k">assert</span> <span class="n">app_self</span> <span class="o">==</span> <span class="n">app</span><span class="p">,</span> <span class="s2">&quot;`main_method`&#39;s bound self must be the same as `app`.&quot;</span>

                <span class="bp">cls</span> <span class="o">=</span> <span class="n">app_self</span><span class="o">.</span><span class="vm">__class__</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span>

            <span class="n">instrument</span><span class="o">.</span><span class="n">include_modules</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
            <span class="n">instrument</span><span class="o">.</span><span class="n">include_classes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="n">instrument</span><span class="o">.</span><span class="n">include_methods</span><span class="p">[</span><span class="n">main_name</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># This does instrumentation:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Needed to split this part to after the instrumentation so that the</span>
        <span class="c1"># getattr below gets the instrumented version of main method.</span>
        <span class="k">if</span> <span class="s1">&#39;main_method&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># Set main_method to the unbound version. Will be passing in app for</span>
            <span class="c1"># &quot;self&quot; manually when needed.</span>
            <span class="n">main_method_loaded</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">main_name</span><span class="p">)</span>

            <span class="c1"># This will be serialized as part of this TruCustomApp. Importatly, it is unbound.</span>
            <span class="n">main_method</span> <span class="o">=</span> <span class="n">Function</span><span class="o">.</span><span class="n">of_function</span><span class="p">(</span><span class="n">main_method_loaded</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">main_method</span> <span class="o">=</span> <span class="n">main_method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_method_loaded</span> <span class="o">=</span> <span class="n">main_method_loaded</span>

        <span class="n">methods_to_instrument</span> <span class="o">=</span> <span class="n">methods_to_instrument</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># The rest of this code instruments methods explicitly passed to</span>
        <span class="c1"># constructor as needing instrumentation and checks that methods</span>
        <span class="c1"># decorated with @instrument or passed explicitly belong to some</span>
        <span class="c1"># component as per serialized version of this app. If they are not,</span>
        <span class="c1"># placeholders are made in `app_extra_json` so that subsequent</span>
        <span class="c1"># serialization looks like the components exist.</span>
        <span class="n">json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">methods_to_instrument</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">method_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="vm">__name__</span>

            <span class="n">full_path</span> <span class="o">=</span> <span class="n">JSONPath</span><span class="p">()</span><span class="o">.</span><span class="n">app</span> <span class="o">+</span> <span class="n">path</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">instrument</span><span class="o">.</span><span class="n">instrument_method</span><span class="p">(</span>
                <span class="n">method_name</span><span class="o">=</span><span class="n">method_name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="vm">__self__</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">full_path</span>
            <span class="p">)</span>

            <span class="c1"># TODO: DEDUP with next condition</span>

            <span class="c1"># Check whether the path/location of the method is in json serialization and</span>
            <span class="c1"># if not, add a placeholder to app_extra_json.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">full_path</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>

                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">UNICODE_CHECK</span><span class="si">}</span><span class="s2"> Added method </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> under component at path </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;App has no component at path </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2"> . &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Specify the component with the `app_extra_json` argument to TruCustomApp constructor. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Creating a placeholder there for now.&quot;</span>
                <span class="p">)</span>

                <span class="n">path</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">app_extra_json</span><span class="p">,</span> <span class="p">{</span>
                        <span class="n">PLACEHOLDER</span><span class="p">:</span>
                            <span class="s2">&quot;I was automatically added to `app_extra_json` because there was nothing here to refer to an instrumented method owner.&quot;</span><span class="p">,</span>
                        <span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
                            <span class="sa">f</span><span class="s2">&quot;Placeholder for method </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="c1"># Check that any functions marked with `TruCustomApp.instrument` has been</span>
        <span class="c1"># instrumented as a method under some object.</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">TruCustomApp</span><span class="o">.</span><span class="n">functions_to_instrument</span><span class="p">:</span>
            <span class="n">obj_ids_methods_and_full_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_methods_for_func</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj_ids_methods_and_full_paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Function </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> was not found during instrumentation walk. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Make sure it is accessible by traversing app </span><span class="si">{</span><span class="n">app</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;or provide a bound method for it as TruCustomApp constructor argument `methods_to_instrument`.&quot;</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">full_path</span> <span class="ow">in</span> <span class="n">obj_ids_methods_and_full_paths</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">next</span><span class="p">(</span><span class="n">full_path</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;App has no component owner of instrumented method </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> at path </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">. &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;Specify the component with the `app_extra_json` argument to TruCustomApp constructor. &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;Creating a placeholder there for now.&quot;</span>
                        <span class="p">)</span>

                        <span class="n">path</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">app_extra_json</span><span class="p">,</span> <span class="p">{</span>
                                <span class="n">PLACEHOLDER</span><span class="p">:</span>
                                    <span class="s2">&quot;I was automatically added to `app_extra_json` because there was nothing here to refer to an instrumented method owner.&quot;</span><span class="p">,</span>
                                <span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
                                    <span class="sa">f</span><span class="s2">&quot;Placeholder for method </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                            <span class="p">}</span>
                        <span class="p">)</span>

        <span class="c1"># DB stuff and checks:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_init</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="c1"># A message for cases where a user calls something that the wrapped</span>
        <span class="c1"># app has but we do not wrap yet.</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">__name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">__name</span><span class="p">):</span>
            <span class="k">return</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;TruCustomApp has no attribute </span><span class="si">{</span><span class="n">__name</span><span class="si">}</span><span class="s2"> but the wrapped app (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span><span class="si">}</span><span class="s2">) does. &quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;If you are calling a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span><span class="si">}</span><span class="s2"> method, retrieve it from that app instead of from `TruCustomApp`. &quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;TruCustomApp nor wrapped app have attribute named </span><span class="si">{</span><span class="n">__name</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">main_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">human</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_method_loaded</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;`main_method` was not specified so we do not know how to run this app.&quot;</span>
            <span class="p">)</span>

        <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_method_loaded</span><span class="p">)</span>
        <span class="n">bindings</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">human</span><span class="p">)</span>  <span class="c1"># self.app is app&#39;s &quot;self&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_method_loaded</span><span class="p">(</span><span class="o">*</span><span class="n">bindings</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">bindings</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # Async work ongoing:</span>
<span class="sd">    async def main_acall(self, human: str):</span>
<span class="sd">        # TODO: work in progress</span>

<span class="sd">        # must return an async generator of tokens/pieces that can be appended to create the full response</span>

<span class="sd">        if self.main_async_method is None:</span>
<span class="sd">            raise RuntimeError(</span>
<span class="sd">                &quot;`main_async_method` was not specified so we do not know how to run this app.&quot;</span>
<span class="sd">            )</span>

<span class="sd">        sig = signature(self.main_async_method)</span>
<span class="sd">        bindings = sig.bind(self.app, human)  # self.app is app&#39;s &quot;self&quot;</span>

<span class="sd">        generator = await self.main_async_method(*bindings.args, **bindings.kwargs)</span>

<span class="sd">        return generator</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="trulens_eval.trulens_eval.tru_custom_app.TruCustomApp.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">methods_to_instrument</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#trulens_eval.trulens_eval.tru_custom_app.TruCustomApp.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Wrap a custom class for recording.</p>
      <ul>
<li>app: Any -- the custom app object being wrapped.</li>
<li>More args in App</li>
<li>More args in AppDefinition</li>
<li>More args in WithClassInfo</li>
</ul>

          <details class="quote">
            <summary>Source code in <code>trulens_eval/trulens_eval/tru_custom_app.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">methods_to_instrument</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrap a custom class for recording.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    - app: Any -- the custom app object being wrapped.</span>
<span class="sd">    - More args in App</span>
<span class="sd">    - More args in AppDefinition</span>
<span class="sd">    - More args in WithClassInfo</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;app&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;root_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="n">of_object</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="n">instrument</span> <span class="o">=</span> <span class="n">Instrument</span><span class="p">(</span>
        <span class="n">app</span><span class="o">=</span><span class="bp">self</span>  <span class="c1"># App mixes in WithInstrumentCallbacks</span>
    <span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;instrument&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instrument</span>

    <span class="k">if</span> <span class="s1">&#39;main_method&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">main_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;main_method&#39;</span><span class="p">]</span>

        <span class="c1"># TODO: ARGPARSE</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">main_method</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">main_method</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="o">**</span><span class="n">main_method</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">main_method</span><span class="p">,</span> <span class="n">Function</span><span class="p">):</span>
            <span class="n">main_method_loaded</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="n">main_name</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="n">name</span>

            <span class="bp">cls</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">main_name</span> <span class="o">=</span> <span class="n">main_method</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">main_method_loaded</span> <span class="o">=</span> <span class="n">main_method</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">main_method_loaded</span><span class="p">,</span> <span class="s2">&quot;__self__&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Please specify `main_method` as a bound method (like `someapp.somemethod` instead of `Someclass.somemethod`).&quot;</span>
                <span class="p">)</span>

            <span class="n">app_self</span> <span class="o">=</span> <span class="n">main_method_loaded</span><span class="o">.</span><span class="vm">__self__</span>

            <span class="k">assert</span> <span class="n">app_self</span> <span class="o">==</span> <span class="n">app</span><span class="p">,</span> <span class="s2">&quot;`main_method`&#39;s bound self must be the same as `app`.&quot;</span>

            <span class="bp">cls</span> <span class="o">=</span> <span class="n">app_self</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span>

        <span class="n">instrument</span><span class="o">.</span><span class="n">include_modules</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">include_classes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">include_methods</span><span class="p">[</span><span class="n">main_name</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>

    <span class="c1"># This does instrumentation:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Needed to split this part to after the instrumentation so that the</span>
    <span class="c1"># getattr below gets the instrumented version of main method.</span>
    <span class="k">if</span> <span class="s1">&#39;main_method&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="c1"># Set main_method to the unbound version. Will be passing in app for</span>
        <span class="c1"># &quot;self&quot; manually when needed.</span>
        <span class="n">main_method_loaded</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">main_name</span><span class="p">)</span>

        <span class="c1"># This will be serialized as part of this TruCustomApp. Importatly, it is unbound.</span>
        <span class="n">main_method</span> <span class="o">=</span> <span class="n">Function</span><span class="o">.</span><span class="n">of_function</span><span class="p">(</span><span class="n">main_method_loaded</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_method</span> <span class="o">=</span> <span class="n">main_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_method_loaded</span> <span class="o">=</span> <span class="n">main_method_loaded</span>

    <span class="n">methods_to_instrument</span> <span class="o">=</span> <span class="n">methods_to_instrument</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># The rest of this code instruments methods explicitly passed to</span>
    <span class="c1"># constructor as needing instrumentation and checks that methods</span>
    <span class="c1"># decorated with @instrument or passed explicitly belong to some</span>
    <span class="c1"># component as per serialized version of this app. If they are not,</span>
    <span class="c1"># placeholders are made in `app_extra_json` so that subsequent</span>
    <span class="c1"># serialization looks like the components exist.</span>
    <span class="n">json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">methods_to_instrument</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="n">full_path</span> <span class="o">=</span> <span class="n">JSONPath</span><span class="p">()</span><span class="o">.</span><span class="n">app</span> <span class="o">+</span> <span class="n">path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instrument</span><span class="o">.</span><span class="n">instrument_method</span><span class="p">(</span>
            <span class="n">method_name</span><span class="o">=</span><span class="n">method_name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="vm">__self__</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">full_path</span>
        <span class="p">)</span>

        <span class="c1"># TODO: DEDUP with next condition</span>

        <span class="c1"># Check whether the path/location of the method is in json serialization and</span>
        <span class="c1"># if not, add a placeholder to app_extra_json.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">full_path</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>

            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">UNICODE_CHECK</span><span class="si">}</span><span class="s2"> Added method </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> under component at path </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;App has no component at path </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2"> . &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Specify the component with the `app_extra_json` argument to TruCustomApp constructor. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Creating a placeholder there for now.&quot;</span>
            <span class="p">)</span>

            <span class="n">path</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app_extra_json</span><span class="p">,</span> <span class="p">{</span>
                    <span class="n">PLACEHOLDER</span><span class="p">:</span>
                        <span class="s2">&quot;I was automatically added to `app_extra_json` because there was nothing here to refer to an instrumented method owner.&quot;</span><span class="p">,</span>
                    <span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
                        <span class="sa">f</span><span class="s2">&quot;Placeholder for method </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">}</span>
            <span class="p">)</span>

    <span class="c1"># Check that any functions marked with `TruCustomApp.instrument` has been</span>
    <span class="c1"># instrumented as a method under some object.</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">TruCustomApp</span><span class="o">.</span><span class="n">functions_to_instrument</span><span class="p">:</span>
        <span class="n">obj_ids_methods_and_full_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_methods_for_func</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj_ids_methods_and_full_paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Function </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> was not found during instrumentation walk. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Make sure it is accessible by traversing app </span><span class="si">{</span><span class="n">app</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;or provide a bound method for it as TruCustomApp constructor argument `methods_to_instrument`.&quot;</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">full_path</span> <span class="ow">in</span> <span class="n">obj_ids_methods_and_full_paths</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">next</span><span class="p">(</span><span class="n">full_path</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;App has no component owner of instrumented method </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> at path </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Specify the component with the `app_extra_json` argument to TruCustomApp constructor. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Creating a placeholder there for now.&quot;</span>
                    <span class="p">)</span>

                    <span class="n">path</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">app_extra_json</span><span class="p">,</span> <span class="p">{</span>
                            <span class="n">PLACEHOLDER</span><span class="p">:</span>
                                <span class="s2">&quot;I was automatically added to `app_extra_json` because there was nothing here to refer to an instrumented method owner.&quot;</span><span class="p">,</span>
                            <span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
                                <span class="sa">f</span><span class="s2">&quot;Placeholder for method </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                        <span class="p">}</span>
                    <span class="p">)</span>

    <span class="c1"># DB stuff and checks:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">post_init</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="trulens_eval.trulens_eval.tru_custom_app.instrument" class="doc doc-heading">
          <code>instrument</code>


<a href="#trulens_eval.trulens_eval.tru_custom_app.instrument" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="trulens_eval.instruments.instrument">base_instrument</span></code></p>

  
      <p>Decorator for marking methods to be instrumented in custom classes that are
wrapped by TruCustomApp.</p>

            <details class="quote">
              <summary>Source code in <code>trulens_eval/trulens_eval/tru_custom_app.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">instrument</span><span class="p">(</span><span class="n">base_instrument</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator for marking methods to be instrumented in custom classes that are</span>
<span class="sd">    wrapped by TruCustomApp.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="n">self_class</span><span class="p">,</span> <span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">base_instrument</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1"># Also make note of it for verification that it was found by the walk</span>
        <span class="c1"># after init.</span>
        <span class="n">TruCustomApp</span><span class="o">.</span><span class="n">functions_to_instrument</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "navigation.path", "search.share", "search.suggest", "toc.follow", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.19047be9.min.js"></script>
      
        <script src="../../../javascript/config.js"></script>
      
        <script src="../../../javascript/app.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="../../../javascript/tex-mml-chtml-3.0.0.js"></script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
      
    
  </body>
</html>