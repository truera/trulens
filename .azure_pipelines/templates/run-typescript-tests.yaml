steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "20.x"
    displayName: Install Node.js

  - bash: |
      set -e
      npm install -g pnpm@9
      echo "Node $(node --version)"
      echo "pnpm $(pnpm --version)"
    displayName: Install pnpm

  - bash: |
      set -e
      cd typescript
      pnpm install --no-frozen-lockfile
      pnpm run build
    displayName: "TypeScript SDK: Install & Build"

  - bash: |
      set -e
      cd typescript
      pnpm run test -- --reporter=default --reporter=junit --outputFile=test-results/junit.xml
    displayName: "TypeScript SDK: Run Tests"

  - task: PublishTestResults@2
    inputs:
      testResultsFormat: JUnit
      testResultsFiles: "typescript/test-results/**/*.xml"
      testRunTitle: "TypeScript SDK Tests"
      mergeTestResults: true
    condition: succeededOrFailed()
    displayName: "Publish TypeScript SDK Test Results"
